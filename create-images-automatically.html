
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Tool support for image creation &#8212; Virtual Machine Image Guide  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-manuals-virtual-machine-image-guide/create-images-automatically.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Converting between image formats" href="convert-images.html" />
    <link rel="prev" title="Example: FreeBSD image" href="freebsd-image.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/openstack-manuals/src/doc/image-guide/source/create-images-automatically.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Tool support for image creation</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="freebsd-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: FreeBSD image"></i></a>
    
    
    <a href="convert-images.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Converting between image formats"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="tool-support-for-image-creation">
<h1>Tool support for image creation<a class="headerlink" href="#tool-support-for-image-creation" title="Permalink to this heading">¶</a></h1>
<p>There are several tools that are designed to automate image creation.</p>
<section id="diskimage-builder">
<h2>Diskimage-builder<a class="headerlink" href="#diskimage-builder" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://docs.openstack.org/diskimage-builder/latest/">Diskimage-builder</a>
is an automated disk image creation tool that supports a variety
of distributions and architectures.
Diskimage-builder (DIB) can build images for Fedora, Red Hat
Enterprise Linux, Ubuntu, Debian, CentOS, and openSUSE.
DIB is organized in a series of elements that build on top of
each other to create specific images.</p>
<p>To build an image, call the following script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>disk-image-create ubuntu vm
</pre></div>
</div>
<p>This example creates a generic, bootable Ubuntu image of the latest release.</p>
<p>Further customization could be accomplished by setting environment
variables or adding elements to the command-line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>disk-image-create -a armhf ubuntu vm
</pre></div>
</div>
<p>This example creates the image as before, but for arm architecture.
More elements are available in the <a class="reference external" href="https://opendev.org/openstack/diskimage-builder/src/branch/master/diskimage_builder/elements">git source directory</a>
and documented in the <a class="reference external" href="https://docs.openstack.org/diskimage-builder/latest/elements.html">diskimage-builder elements documentation</a>.</p>
</section>
<section id="oz">
<h2>Oz<a class="headerlink" href="#oz" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/clalancette/oz/wiki">Oz</a> is a command-line tool
that automates the process of creating a virtual machine image file.
Oz is a Python app that interacts with KVM to step through the process
of installing a virtual machine.</p>
<p>It uses a predefined set of kickstart (Red Hat-based systems) and
preseed files (Debian-based systems) for operating systems that it
supports, and it can also be used to create Microsoft Windows images.</p>
<p>A full treatment of Oz is beyond the scope of this document,
but we will provide an example. You can find additional examples of
Oz template files on GitHub at <a class="reference external" href="https://github.com/rcbops/oz-image-build/tree/master/templates">rcbops/oz-image-build/tree/master/templates</a>.
Here’s how you would create a CentOS 6.4 image with Oz.</p>
<p>Create a template file called <code class="docutils literal notranslate"><span class="pre">centos64.tdl</span></code> with
the following contents. The only entry you will need to
change is the <code class="docutils literal notranslate"><span class="pre">&lt;rootpw&gt;</span></code> contents.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;template&gt;</span>
  <span class="nt">&lt;name&gt;</span>centos64<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;os&gt;</span>
    <span class="nt">&lt;name&gt;</span>CentOS-6<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;version&gt;</span>4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;arch&gt;</span>x86_64<span class="nt">&lt;/arch&gt;</span>
    <span class="nt">&lt;install</span> <span class="na">type=</span><span class="s">&#39;iso&#39;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;iso&gt;</span>http://mirror.rackspace.com/CentOS/6/isos/x86_64/CentOS-6.4-x86_64-bin-DVD1.iso<span class="nt">&lt;/iso&gt;</span>
    <span class="nt">&lt;/install&gt;</span>
    <span class="nt">&lt;rootpw&gt;</span>CHANGE THIS TO YOUR ROOT PASSWORD<span class="nt">&lt;/rootpw&gt;</span>
  <span class="nt">&lt;/os&gt;</span>
  <span class="nt">&lt;description&gt;</span>CentOS 6.4 x86_64<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository</span> <span class="na">name=</span><span class="s">&#39;epel-6&#39;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;url&gt;</span>http://download.fedoraproject.org/pub/epel/6/$basearch<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;signed&gt;</span>no<span class="nt">&lt;/signed&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>
  <span class="nt">&lt;packages&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#39;epel-release&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#39;cloud-utils&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#39;cloud-init&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/packages&gt;</span>
  <span class="nt">&lt;commands&gt;</span>
    <span class="nt">&lt;command</span> <span class="na">name=</span><span class="s">&#39;update&#39;</span><span class="nt">&gt;</span>
yum -y update
yum clean all
sed -i &#39;/^HWADDR/d&#39; /etc/sysconfig/network-scripts/ifcfg-eth0
echo -n &gt; /etc/udev/rules.d/70-persistent-net.rules
echo -n &gt; /lib/udev/rules.d/75-persistent-net-generator.rules
    <span class="nt">&lt;/command&gt;</span>
  <span class="nt">&lt;/commands&gt;</span>
<span class="nt">&lt;/template&gt;</span>
</pre></div>
</div>
<p>This Oz template specifies where to download the Centos 6.4 install ISO.
Oz will use the version information to identify which kickstart file to use.
In this case, it will be <a class="reference external" href="https://github.com/clalancette/oz/blob/master/oz/auto/RHEL6.auto">RHEL6.auto</a>.
It adds EPEL as a repository and install the <code class="docutils literal notranslate"><span class="pre">epel-release</span></code>,
<code class="docutils literal notranslate"><span class="pre">cloud-utils</span></code>, and <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code> packages, as specified in the
<code class="docutils literal notranslate"><span class="pre">packages</span></code> section of the file.</p>
<p>After Oz completes the initial OS install using the kickstart file,
it customizes the image with an update. It also removes any reference
to the eth0 device that libvirt creates while Oz does the customizing,
as specified in the <code class="docutils literal notranslate"><span class="pre">command</span></code> section of the XML file.</p>
<p>To run this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>oz-install -d3 -u centos64.tdl -x centos64-libvirt.xml
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">-d3</span></code> flag tells Oz to show status information as it runs.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-u</span></code> tells Oz to do the customization (install extra packages,
run the commands) once it does the initial install.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-x</span></code> flag tells Oz what filename to use to write out
a libvirt XML file (otherwise it will default to something
like <code class="docutils literal notranslate"><span class="pre">centos64Apr_03_2013-12:39:42</span></code>).</p></li>
</ul>
<p>If you leave out the <code class="docutils literal notranslate"><span class="pre">-u</span></code> flag, or you want to edit the file
to do additional customizations, you can use the <strong class="command">oz-customize</strong>
command, using the libvirt XML file that <strong class="command">oz-install</strong> creates.
For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>oz-customize -d3 centos64.tdl centos64-libvirt.xml
</pre></div>
</div>
<p>Oz will invoke libvirt to boot the image inside of KVM,
then Oz will ssh into the instance and perform the customizations.</p>
</section>
<section id="veewee">
<h2>VeeWee<a class="headerlink" href="#veewee" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/jedi4ever/veewee">VeeWee</a> is often used
to build <a class="reference external" href="http://vagrantup.com">Vagrant</a> boxes,
but it can also be used to build the KVM images.</p>
</section>
<section id="packer">
<h2>Packer<a class="headerlink" href="#packer" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://packer.io">Packer</a> is a tool for creating machine
images for multiple platforms from a single source configuration.</p>
</section>
<section id="image-bootstrap">
<h2>image-bootstrap<a class="headerlink" href="#image-bootstrap" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/hartwork/image-bootstrap">image-bootstrap</a>
is a command line tool that generates bootable virtual machine images
with support of Arch, Debian, Gentoo, Ubuntu, and is prepared for use
with OpenStack.</p>
</section>
<section id="imagefactory">
<h2>imagefactory<a class="headerlink" href="#imagefactory" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="http://imgfac.org/">imagefactory</a> is a newer tool designed
to automate the building, converting, and uploading images
to different cloud providers. It uses Oz as its back-end and
includes support for OpenStack-based clouds.</p>
</section>
<section id="kiwi">
<h2>KIWI<a class="headerlink" href="#kiwi" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference external" href="http://github.com/openSUSE/kiwi">KIWI OS image builder</a>
provides an operating system image builder for various Linux supported
hardware platforms as well as for virtualization and cloud systems. It
allows building of images based on openSUSE, SUSE Linux Enterprise,
and Red Hat Enterprise Linux. The <a class="reference external" href="https://doc.opensuse.org/#kiwi-doc">openSUSE Documentation</a> explains how to use KIWI.</p>
</section>
<section id="virt-builder">
<h2>virt-builder<a class="headerlink" href="#virt-builder" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="http://libguestfs.org/virt-builder.1.html">Virt-builder</a> is a tool for
quickly building new virtual machines. You can build a variety of VMs for
local or cloud use, usually within a few minutes or less. Virt-builder also
has many ways to customize these VMs. Everything is run from the command line
and nothing requires root privileges, so automation and scripting is simple.</p>
<p>To build an image, call the following script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>virt-builder fedora-23 -o image.qcow2 --format qcow2 <span class="se">\</span>
  --update --selinux-relabel --size 20G
</pre></div>
</div>
<p>To list the operating systems available to install:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>virt-builder --list
</pre></div>
</div>
<p>To import it into libvirt with <strong class="command">virsh</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>virt-install --name fedora --ram <span class="m">2048</span> <span class="se">\</span>
  --disk <span class="nv">path</span><span class="o">=</span>image.qcow2,format<span class="o">=</span>qcow2 --import
</pre></div>
</div>
</section>
<section id="openstack-debian-images">
<h2>openstack-debian-images<a class="headerlink" href="#openstack-debian-images" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://packages.debian.org/openstack-debian-images">openstack-debian-images</a>
is the tool Debian uses to create its official OpenStack image. It is made of
a single very simple shell script that is easy to understand and modify.
It supports Grub and Syslinux, BIOS or EFI, amd64 and arm64 arch.</p>
<p>openstack-debian-images can also be used to create a bootable image directly
on a hard disk, instead of using the Debian installer.</p>
<p>To build an image, type this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>build-openstack-debian-image --release stretch
</pre></div>
</div>
<p>More parameters can be added to further customize the image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>build-openstack-debian-image --release stretch <span class="se">\</span>
  --hook-script /root/my-hook-script.sh <span class="se">\</span>
  --debootstrap-url http://ftp.fr.debian.org/debian <span class="se">\</span>
  --sources.list-mirror http://ftp.fr.debian.org/debian <span class="se">\</span>
  --login myusername <span class="se">\</span>
  --extra-packages vim,emacs
</pre></div>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">/root/my-hook-script.sh</span></code> will recieve 2 environment variable:
<code class="docutils literal notranslate"><span class="pre">BODI_CHROOT_PATH</span></code> path where the image is mounted, and <code class="docutils literal notranslate"><span class="pre">BODI_RELEASE</span></code>
which is the name of the Debian release that is being bootstraped. Here’s
an example for customizing the motd:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span><span class="ch">#!/bin/sh</span>
<span class="go">  set -e</span>
<span class="go">  echo &quot;My message&quot; &gt;${BODI_CHROOT_PATH}/etc/motd</span>
</pre></div>
</div>
<p>This hook script will conveniently be called at the correct moment of the
build process, when everything is installed, but before unmounting the
partition.</p>
</section>
<section id="windows-openstack-imaging-tools">
<h2>windows-openstack-imaging-tools<a class="headerlink" href="#windows-openstack-imaging-tools" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/cloudbase/windows-openstack-imaging-tools">windows-openstack-imaging-tools</a>
is a PowerShell module that automates the Windows image creation for
OpenStack and supports building VHDX, QCOW2, RAW and VMDK image types.</p>
<p>For easier installation, the tool is published as a PowerShellGallery module
<a class="reference external" href="https://www.powershellgallery.com/packages/WindowsImageBuilder">WindowsImageBuilder</a>.</p>
<p>Windows image build example:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="c"># Install and import WindowsImageBuilder module from PowerShellGallery</span>
<span class="nb">Install-Module</span> <span class="n">WindowsImageBuilder</span> <span class="n">-Force</span>
<span class="nb">Import-Module</span> <span class="n">WindowsImageBuilder</span>

<span class="nb">New-WindowsImageConfig</span> <span class="n">-ConfigFilePath</span> <span class="s2">&quot;.\windows-image-config.ini&quot;</span>
<span class="c"># Update the configuration file to fit your specific use case</span>
<span class="c"># Extensive information for all the configuration can be found here:</span>
<span class="c"># https://github.com/cloudbase/windows-openstack-imaging-tools/blob/master/Config.psm1#L21</span>

<span class="c"># Generate the Windows image</span>
<span class="nb">New-WindowsOnlineImage</span> <span class="n">-ConfigFilePath</span> <span class="s2">&quot;.\windows-image-config.ini&quot;</span>
</pre></div>
</div>
<p>Requirements:</p>
<ul class="simple">
<li><p>A Windows host, with Hyper-V virtualization enabled, PowerShell &gt;=v4
support and Windows Assessment and Deployment Kit (ADK).</p></li>
<li><p>A Windows installation ISO or DVD.</p></li>
<li><p>Windows compatible drivers, if required by the target environment.
For example, <a class="reference external" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/">VirtIO</a>,
network card, or storage adapter drivers.</p></li>
<li><p>Git environment.</p></li>
</ul>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="freebsd-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: FreeBSD image"></i></a>
          
          
            <a href="convert-images.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Converting between image formats"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2022-12-26 10:49:07</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Virtual Machine Image Guide </h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="obtain-images.html">Get images</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack-images.html">Image requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="modify-images.html">Modify images</a></li>
<li class="toctree-l1"><a class="reference internal" href="create-images-manually.html">Create images manually</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tool support for image creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#diskimage-builder">Diskimage-builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#oz">Oz</a></li>
<li class="toctree-l2"><a class="reference internal" href="#veewee">VeeWee</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packer">Packer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-bootstrap">image-bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#imagefactory">imagefactory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kiwi">KIWI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virt-builder">virt-builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openstack-debian-images">openstack-debian-images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#windows-openstack-imaging-tools">windows-openstack-imaging-tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="convert-images.html">Converting between image formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="share-images.html">Image sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/appendix.html">Appendix</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Tool support for image creation</a><ul>
<li><a class="reference internal" href="#diskimage-builder">Diskimage-builder</a></li>
<li><a class="reference internal" href="#oz">Oz</a></li>
<li><a class="reference internal" href="#veewee">VeeWee</a></li>
<li><a class="reference internal" href="#packer">Packer</a></li>
<li><a class="reference internal" href="#image-bootstrap">image-bootstrap</a></li>
<li><a class="reference internal" href="#imagefactory">imagefactory</a></li>
<li><a class="reference internal" href="#kiwi">KIWI</a></li>
<li><a class="reference internal" href="#virt-builder">virt-builder</a></li>
<li><a class="reference internal" href="#openstack-debian-images">openstack-debian-images</a></li>
<li><a class="reference internal" href="#windows-openstack-imaging-tools">windows-openstack-imaging-tools</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "create-images-automatically" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/openstack-manuals/src/doc/image-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: bf388c77ad0e3655b1c07b7f3d325a61dee86c6f";
    var repositoryName = "openstack/openstack-manuals";
    var bugProject = "openstack-manuals";
    var bugTitle = "Tool support for image creation in Virtual Machine Image Guide";
    var fieldTags = "image-guide";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release:  on 2022-12-26 10:49:07";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "create-images-automatically";
    var pdfFileName = "ImageGuide.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>