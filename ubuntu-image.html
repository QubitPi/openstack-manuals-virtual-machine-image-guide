
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Example: Ubuntu image &#8212; Virtual Machine Image Guide  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-manuals-virtual-machine-image-guide/ubuntu-image.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example: Fedora image" href="fedora-image.html" />
    <link rel="prev" title="Example: CentOS image" href="centos-image.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/openstack-manuals/src/doc/image-guide/source/ubuntu-image.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Example: Ubuntu image</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="centos-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: CentOS image"></i></a>
    
    
    <a href="fedora-image.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Example: Fedora image"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="example-ubuntu-image">
<h1>Example: Ubuntu image<a class="headerlink" href="#example-ubuntu-image" title="Permalink to this heading">¶</a></h1>
<p>This example installs an Ubuntu 18.04 (Bionic Beaver) image.
To create an image for a different version of Ubuntu,
follow these steps with the noted differences.</p>
<section id="download-an-ubuntu-installation-iso">
<h2>Download an Ubuntu installation ISO<a class="headerlink" href="#download-an-ubuntu-installation-iso" title="Permalink to this heading">¶</a></h2>
<p>Because the goal is to make the smallest possible base image,
this example uses the network installation ISO.
The Ubuntu 64-bit 18.04 network installation ISO is at the <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/mini.iso">Ubuntu download
page</a>.</p>
</section>
<section id="start-the-installation-process">
<h2>Start the installation process<a class="headerlink" href="#start-the-installation-process" title="Permalink to this heading">¶</a></h2>
<p>Start the installation process by using either <strong class="command">virt-manager</strong>
or <strong class="command">virt-install</strong> as described in the previous section.
If you use <strong class="command">virt-install</strong>, do not forget to connect
your VNC client to the virtual machine.</p>
<p>Assume that the name of your virtual machine image is <code class="docutils literal notranslate"><span class="pre">ubuntu-18.04</span></code>,
which you need to know when you use <strong class="command">virsh</strong> commands
to manipulate the state of the image.</p>
<p>If you are using <strong class="command">virt-manager</strong>,
the commands should look something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>wget -O /var/lib/libvirt/boot/bionic-mini.iso <span class="se">\</span>
  http://archive.ubuntu.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/mini.iso
<span class="gp"># </span>chown libvirt-qemu:kvm /var/lib/libvirt/boot/bionic-mini.iso
<span class="gp"># </span>qemu-img create -f qcow2 /var/lib/libvirt/images/bionic.qcow2 10G
<span class="gp"># </span>chown libvirt-qemu:kvm /var/lib/libvirt/images/bionic.qcow2
<span class="gp"># </span>virt-install --virt-type kvm --name bionic --ram <span class="m">1024</span> <span class="se">\</span>
  --cdrom<span class="o">=</span>/var/lib/libvirt/boot/bionic-mini.iso <span class="se">\</span>
  --disk /var/lib/libvirt/images/bionic.qcow2,bus<span class="o">=</span>virtio,size<span class="o">=</span><span class="m">10</span>,format<span class="o">=</span>qcow2 <span class="se">\</span>
  --network <span class="nv">network</span><span class="o">=</span>default <span class="se">\</span>
  --graphics vnc,listen<span class="o">=</span><span class="m">0</span>.0.0.0 --noautoconsole <span class="se">\</span>
  --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntu18.04
</pre></div>
</div>
</section>
<section id="step-through-the-installation">
<h2>Step through the installation<a class="headerlink" href="#step-through-the-installation" title="Permalink to this heading">¶</a></h2>
<p>At the initial Installer boot menu, choose the <span class="guilabel">Install</span> option.
Step through the installation prompts, the defaults should be fine.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/ubuntu-install.png"><img alt="_images/ubuntu-install.png" src="_images/ubuntu-install.png" style="width: 100%;" /></a>
</figure>
</section>
<section id="hostname">
<h2>Hostname<a class="headerlink" href="#hostname" title="Permalink to this heading">¶</a></h2>
<p>The installer may ask you to choose a host name.
The default (<code class="docutils literal notranslate"><span class="pre">ubuntu</span></code>) is fine. We will install the cloud-init
package later, which will set the host name on boot when a new
instance is provisioned using this image.</p>
</section>
<section id="select-a-mirror">
<h2>Select a mirror<a class="headerlink" href="#select-a-mirror" title="Permalink to this heading">¶</a></h2>
<p>The default mirror proposed by the installer should be fine.</p>
</section>
<section id="step-through-the-install">
<h2>Step through the install<a class="headerlink" href="#step-through-the-install" title="Permalink to this heading">¶</a></h2>
<p>Step through the install, using the default options.
When prompted for a user name, the default (<code class="docutils literal notranslate"><span class="pre">ubuntu</span></code>) is fine.</p>
</section>
<section id="partition-the-disks">
<h2>Partition the disks<a class="headerlink" href="#partition-the-disks" title="Permalink to this heading">¶</a></h2>
<p>There are different options for partitioning the disks.
The default installation will use LVM partitions, and will create
three partitions (<code class="docutils literal notranslate"><span class="pre">/boot</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, swap), and this will work fine.
Alternatively, you may wish to create a single ext4 partition,
mounted to “<code class="docutils literal notranslate"><span class="pre">/</span></code>”, should also work fine.</p>
<p>If unsure, we recommend you use the installer’s default partition
scheme, since there is no clear advantage to one scheme or another.</p>
</section>
<section id="automatic-updates">
<h2>Automatic updates<a class="headerlink" href="#automatic-updates" title="Permalink to this heading">¶</a></h2>
<p>The Ubuntu installer will ask how you want to manage upgrades
on your system. This option depends on your specific use case.
If your virtual machine instances will be connected to the
Internet, we recommend “Install security updates automatically”.</p>
</section>
<section id="software-selection-openssh-server">
<h2>Software selection: OpenSSH server<a class="headerlink" href="#software-selection-openssh-server" title="Permalink to this heading">¶</a></h2>
<p>Choose <span class="guilabel">OpenSSH server</span> so that you will be able to SSH into
the virtual machine when it launches inside of an OpenStack cloud.</p>
<figure class="align-default">
<img alt="_images/ubuntu-software-selection.png" src="_images/ubuntu-software-selection.png" />
</figure>
</section>
<section id="install-grub-boot-loader">
<h2>Install GRUB boot loader<a class="headerlink" href="#install-grub-boot-loader" title="Permalink to this heading">¶</a></h2>
<p>Select <span class="guilabel">Yes</span> when asked about installing the GRUB boot loader
to the master boot record.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/ubuntu-grub.png"><img alt="_images/ubuntu-grub.png" src="_images/ubuntu-grub.png" style="width: 100%;" /></a>
</figure>
<p>For more information on configuring Grub, see the section
called “<a class="reference internal" href="openstack-images.html#write-to-console"><span class="std std-ref">Ensure image writes boot log to console</span></a>”.</p>
</section>
<section id="log-in-to-newly-created-image">
<h2>Log in to newly created image<a class="headerlink" href="#log-in-to-newly-created-image" title="Permalink to this heading">¶</a></h2>
<p>When you boot for the first time after install, it may ask
you about authentication tools, you can just choose <span class="guilabel">Exit</span>.
Then, log in as admin user using the password you specified.</p>
</section>
<section id="install-cloud-init">
<h2>Install cloud-init<a class="headerlink" href="#install-cloud-init" title="Permalink to this heading">¶</a></h2>
<p>The <strong class="command">cloud-init</strong> script starts on instance boot and
will search for a metadata provider to fetch a public key from.
The public key will be placed in the default user account for the image.</p>
<p>Install the <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code> package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt install cloud-init
</pre></div>
</div>
<p>When building Ubuntu images <strong class="command">cloud-init</strong> must be
explicitly configured for the metadata source in use.
The OpenStack metadata server emulates the EC2 metadata
service used by images in Amazon EC2.</p>
<p>To set the metadata source to be used by the image run the
<strong class="command">dpkg-reconfigure</strong> command against the <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code>
package. When prompted select the <span class="guilabel">EC2</span> data source:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>dpkg-reconfigure cloud-init
</pre></div>
</div>
<p>The account varies by distribution.
On Ubuntu-based virtual machines, the account is called <code class="docutils literal notranslate"><span class="pre">ubuntu</span></code>.
On Fedora-based virtual machines, the account is called <code class="docutils literal notranslate"><span class="pre">ec2-user</span></code>.</p>
<p>You can change the name of the account used by <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code>
by editing the <code class="docutils literal notranslate"><span class="pre">/etc/cloud/cloud.cfg</span></code> file and adding a line
with a different user. For example, to configure <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code>
to put the key in an account named <code class="docutils literal notranslate"><span class="pre">admin</span></code>, use the following
syntax in the configuration file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">users:</span>
<span class="go">  - name: admin</span>
<span class="go">    (...)</span>
</pre></div>
</div>
</section>
<section id="shut-down-the-instance">
<h2>Shut down the instance<a class="headerlink" href="#shut-down-the-instance" title="Permalink to this heading">¶</a></h2>
<p>From inside the instance, as root:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/sbin/shutdown -h now
</pre></div>
</div>
</section>
<section id="clean-up-remove-mac-address-details">
<h2>Clean up (remove MAC address details)<a class="headerlink" href="#clean-up-remove-mac-address-details" title="Permalink to this heading">¶</a></h2>
<p>The operating system records the MAC address of the virtual Ethernet
card in locations such as <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/70-persistent-net.rules</span></code>
during the installation process. However, each time the image boots up,
the virtual Ethernet card will have a different MAC address,
so this information must be deleted from the configuration file.</p>
<p>There is a utility called <strong class="command">virt-sysprep</strong>, that performs
various cleanup tasks such as removing the MAC address references.
It will clean up a virtual machine image in place:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>virt-sysprep -d bionic
</pre></div>
</div>
</section>
<section id="undefine-the-libvirt-domain">
<h2>Undefine the libvirt domain<a class="headerlink" href="#undefine-the-libvirt-domain" title="Permalink to this heading">¶</a></h2>
<p>Now that the image is ready to be uploaded to the Image service,
you no longer need to have this virtual machine image managed by libvirt.
Use the <strong class="command">virsh undefine vm-image</strong> command to inform libvirt:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>virsh undefine bionic
</pre></div>
</div>
</section>
<section id="image-is-complete">
<h2>Image is complete<a class="headerlink" href="#image-is-complete" title="Permalink to this heading">¶</a></h2>
<p>The underlying image file that you created with the
<strong class="command">qemu-img create</strong> command, such as
<code class="docutils literal notranslate"><span class="pre">/var/lib/libvirt/images/bionic.qcow2</span></code>,
is now ready for uploading to the Image service by using the
<strong class="command">openstack image create</strong> command. For more information,
see the <a class="reference external" href="https://docs.openstack.org/glance/latest/user/index.html">Glance User Guide</a>.</p>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="centos-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: CentOS image"></i></a>
          
          
            <a href="fedora-image.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Example: Fedora image"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2022-12-26 10:49:07</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Virtual Machine Image Guide </h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="obtain-images.html">Get images</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack-images.html">Image requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="modify-images.html">Modify images</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="create-images-manually.html">Create images manually</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="net-running.html">Verify the libvirt default network is running</a></li>
<li class="toctree-l2"><a class="reference internal" href="virt-manager.html">Use the virt-manager X11 GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="virt-install.html">Use virt-install and connect by using a local VNC client</a></li>
<li class="toctree-l2"><a class="reference internal" href="centos-image.html">Example: CentOS image</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example: Ubuntu image</a></li>
<li class="toctree-l2"><a class="reference internal" href="fedora-image.html">Example: Fedora image</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows-image.html">Example: Microsoft Windows image</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd-image.html">Example: FreeBSD image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="create-images-automatically.html">Tool support for image creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="convert-images.html">Converting between image formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="share-images.html">Image sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/appendix.html">Appendix</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Example: Ubuntu image</a><ul>
<li><a class="reference internal" href="#download-an-ubuntu-installation-iso">Download an Ubuntu installation ISO</a></li>
<li><a class="reference internal" href="#start-the-installation-process">Start the installation process</a></li>
<li><a class="reference internal" href="#step-through-the-installation">Step through the installation</a></li>
<li><a class="reference internal" href="#hostname">Hostname</a></li>
<li><a class="reference internal" href="#select-a-mirror">Select a mirror</a></li>
<li><a class="reference internal" href="#step-through-the-install">Step through the install</a></li>
<li><a class="reference internal" href="#partition-the-disks">Partition the disks</a></li>
<li><a class="reference internal" href="#automatic-updates">Automatic updates</a></li>
<li><a class="reference internal" href="#software-selection-openssh-server">Software selection: OpenSSH server</a></li>
<li><a class="reference internal" href="#install-grub-boot-loader">Install GRUB boot loader</a></li>
<li><a class="reference internal" href="#log-in-to-newly-created-image">Log in to newly created image</a></li>
<li><a class="reference internal" href="#install-cloud-init">Install cloud-init</a></li>
<li><a class="reference internal" href="#shut-down-the-instance">Shut down the instance</a></li>
<li><a class="reference internal" href="#clean-up-remove-mac-address-details">Clean up (remove MAC address details)</a></li>
<li><a class="reference internal" href="#undefine-the-libvirt-domain">Undefine the libvirt domain</a></li>
<li><a class="reference internal" href="#image-is-complete">Image is complete</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "ubuntu-image" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/openstack-manuals/src/doc/image-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: bf388c77ad0e3655b1c07b7f3d325a61dee86c6f";
    var repositoryName = "openstack/openstack-manuals";
    var bugProject = "openstack-manuals";
    var bugTitle = "Example: Ubuntu image in Virtual Machine Image Guide";
    var fieldTags = "image-guide";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release:  on 2022-12-26 10:49:07";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "ubuntu-image";
    var pdfFileName = "ImageGuide.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>